#!/bin/bash

########################################################################################################################
# Bash settings ########################################################################################################
########################################################################################################################
# abort on nonzero exitstatus
set -o errexit
# abort on unbound variable
set -o nounset
# don't hide errors within pipes
set -o pipefail
# enable expansion of variables
# set -o xtrace # Uncomment this line for debugging purposes

########################################################################################################################
# Arguments ############################################################################################################
########################################################################################################################
KAFKA_SERVER=$1
KAFKA_PORT=$2
KAFKA_TOPIC=$3
KAFKA_GROUP_ID=$4
IMAGE_HEIGHT=$4
IMAGE_WIDTH=$4

########################################################################################################################
# Run ##################################################################################################################
########################################################################################################################
TAG="0.1.0"
IMAGE_NAME=etl

docker run  --name "${IMAGE_NAME}" \
            --rm \
            -e KAFKA_SERVER "${KAFKA_SERVER}" \
            -e KAFKA_PORT "${KAFKA_PORT}" \
            -e KAFKA_TOPIC "${KAFKA_TOPIC}" \
            -e KAFKA_GROUP_ID "${KAFKA_GROUP_ID}" \
            -e IMAGE_HEIGHT "${IMAGE_HEIGHT}" \
            -e IMAGE_WIDTH "${IMAGE_WIDTH}" \
            -e CONSUMER_RUNNING "true" \
            "${IMAGE_NAME}:${TAG}"

